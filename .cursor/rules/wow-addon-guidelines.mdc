---
description: WoW addon development — localize globals, namespace addon, use Ace3 for config
globs: "**/*.lua"
alwaysApply: false
---

# World of Warcraft Addon Guidelines

Follow these when creating or editing WoW addons in this project.

## 1. Localize Globals

WoW uses a **shared global namespace**. All addons run in the same environment, so polluting globals causes conflicts and taint.

- **At the top of every Lua file**, after the addon namespace line, localize any globals you use:
  - Lua: `local table, pairs, ipairs, type, string, print = table, pairs, ipairs, type, string, print`
  - WoW API: `local CreateFrame, UIParent = CreateFrame, UIParent`
  - WoW C_*: `local C_QuestLog, C_Map, C_Timer = C_QuestLog, C_Map, C_Timer`
- **Do not** assign new globals (e.g. avoid `function MyFunc()` at top level unless intentionally global). Prefer attaching to the addon table.

Example:

```lua
local AddonName, MyAddon = ...
local table, pairs, ipairs = table, pairs, ipairs
local CreateFrame, UIParent = CreateFrame, UIParent
local C_QuestLog = C_QuestLog
-- use MyAddon:DoThing() and locals only
```

## 2. Namespace the Addon

- Use a **single addon table** (e.g. `TTQ`, `MyAddon`) and attach all addon state and functions to it.
- Expose only that table globally if needed: `_G.MyAddonName = MyAddon`
- Do not create other globals (no global function names, no global config tables).

## 3. Configuration Menu and Slash Commands — Use Ace3

When building a **configuration menu** or **slash commands**:

- **Use the Ace3 library** (AceConfig-3.0 for options table, AceConsole-3.0 for slash commands) instead of hand-rolled Blizzard Settings or custom frames. This avoids ~1000 lines of boilerplate and keeps options consistent with other addons.
- Embed: `AceLibrary`, `AceConsole`, `AceConfig` (and optionally `AceConfigDialog` for the GUI).
- Define options as a table and register with AceConfig; register slash commands with AceConsole.

If the addon already uses Blizzard Settings (e.g. `Settings.RegisterVerticalLayoutCategory`), you may keep it; for **new** addons or new config features, prefer Ace3.

## 4. Shared Libraries for UI (Dropdowns, Menus)

WoW does **not** ship a standard dropdown or popup menu library. Common options:

- **Blizzard `UIDropDownMenu`** — Built-in but addon-loaded; can taint in combat, and behavior varies by patch. Many addons avoid it for custom frames.
- **LibStub + LibDropdown** (or **AceGUI dropdown**) — Optional embedded libs; add a dependency and increase addon size. Good if you need many dropdowns.
- **Custom frames** — What TommyTwoquests uses: a simple `CreateFrame("Frame")` with backdrop, click-catcher to close, and buttons for options. No external deps; requires storing references (e.g. `frame.rows`) so refresh logic can find them.

When using custom dropdowns/menus: keep a single creation function, assign all dynamic controls to the frame (e.g. `frame.rows = rows`) so show/refresh can update them, and use a full-screen click-catcher to close on outside click.

---

**Summary**

1. **Localize** all used globals at the top of each file.
2. **Namespace** everything on a single addon table; expose at most one global.
3. **Ace3** for options table and slash commands when building configuration.
4. **Dropdowns/menus**: Blizzard UIDropDownMenu can taint; custom frames are fine—store refs (e.g. `frame.rows`) so refresh works.
